<eform-new-subheader
  [title]="currentTemplate.label"
  [forceStaticTitle]="true"
></eform-new-subheader>

<div class="d-grid justify-content-between" style="grid-template-columns: 5fr 2fr;">
  <div class="mr-4 d-flex flex-column">
    <!-- Done at user editable -->
    <mat-card *ngIf="currentTemplate.isDoneAtEditable" class="mb-4">
      <mat-card-header>
        {{ 'Done at' | translate }}
      </mat-card-header>
      <mat-card-content>
        <mat-form-field [owlDateTimeTrigger]="dt1">
          <mat-label>{{ 'Select date' | translate }}</mat-label>
          <mat-icon matPrefix>calendar_today</mat-icon>
          <input
            matInput
            id="doneAt"
            name="doneAt"
            [owlDateTime]="dt1"
            [(ngModel)]="replyElement.doneAt"
            required
            type="text"
          >
          <owl-date-time [pickerType]="'calendar'" #dt1 [firstDayOfWeek]="1"></owl-date-time>
          <mat-error class="text-warn" *ngIf="!replyElement.doneAt">
            {{'Date is required'| translate}}*
          </mat-error>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <!-- Elements loop -->
    <app-case-edit-element
      [element]="elem"
      *ngFor="let elem of replyElement.elementList"
      (needUpdate)="partialLoadCase()"
    ></app-case-edit-element>
  </div>

  <!-- Right section with navigation -->
  <div>
    <mat-card style=" position: sticky; top: 0;">
      <mat-card-header>
        {{ replyElement.label }}
      </mat-card-header>
      <mat-card-content style="max-height: 50vh; overflow: auto;">
          <div
            *ngFor="let element of replyElement.elementList"
            style="cursor: pointer"
            routerLinkActive="active"
          >
            <a
              mat-button
              (click)="goToSection('#section' + element.id)"
              class="d-flex w-100"
            >
              {{ element.label }}
            </a>
            <ng-container *ngIf="element.elementList">
              <app-case-edit-nav [element]="element"></app-case-edit-nav>
            </ng-container>
          </div>
      </mat-card-content>
      <mat-card-footer
        *ngIf="checkEformPermissions(userClaimsEnum.caseUpdate)"
        class="d-flex justify-content-center align-items-center mt-2 mb-2"
      >
        <button
          mat-raised-button
          color="accent"
          (click)="saveCase(); this.isSaveClicked = true"
          id="submit_form"
        >
          {{ 'Save' | translate }}
        </button>
      </mat-card-footer>
    </mat-card>
  </div>
</div>
