<eform-new-subheader></eform-new-subheader>

<form [formGroup]="changePasswordForm" class="d-flex flex-row justify-content-center">
  <mat-card class="card--no-border" style="width: 70%">
    <div class="d-flex flex-column gap-24">
      <div class="d-flex flex-column gap-12">
        <mat-form-field>
          <mat-label>{{ 'Enter old password' | translate }}</mat-label>
          <input
            matInput
            type="password"
            name="oldPassword"
            formControlName="oldPassword"
            required
            id="oldPassword"
            autocomplete="current-password"
          >
        </mat-form-field>
        <div class="d-flex flex-column">
          <mat-form-field>
            <mat-label>{{ 'New password' | translate }}</mat-label>
            <input
              matInput
              [type]="newPasswordVisible ? 'text' : 'password'"
              name="newPassword"
              formControlName="newPassword"
              required
              id="newPassword"
              autocomplete="new-password"
            />
            <mat-icon
              matSuffix
              (click)="toggleNewPasswordVisibility()"
              style="cursor: pointer;"
              [attr.aria-label]="'Toggle password visibility'"
            >
              {{newPasswordVisible ? 'visibility_off' : 'visibility'}}
            </mat-icon>
            <mat-error *ngIf="changePasswordForm.controls['newPassword'].hasError('required')">{{'New Password field is required'| translate}}</mat-error>
            <mat-error *ngIf="changePasswordForm.controls['newPassword'].hasError('minlength')">{{'New Password field must contain at least ' + this.changePasswordForm.controls['newPassword'].errors['minlength'].requiredLength + ' characters.'| translate}}</mat-error>
          </mat-form-field>
          <mat-password-strength
            [password]="changePasswordForm.get('newPassword')?.value || ''"
            [enableLengthRule]="true"
            [enableLowerCaseLetterRule]="true"
            [enableUpperCaseLetterRule]="true"
            [enableDigitRule]="true"
            [enableSpecialCharRule]="false"
            [min]="8"
            [max]="50"
            (onStrengthChanged)="onPasswordStrengthChanged($event)">
          </mat-password-strength>
        </div>
        <mat-form-field>
          <mat-label>{{ 'New password confirmation' | translate }}</mat-label>
          <input
            matInput
            [type]="newPasswordConfirmVisible ? 'text' : 'password'"
            formControlName="confirmPassword"
            required
            id="newPasswordConfirmation"
            name="newPasswordConfirmation"
            autocomplete="new-password"
          />
          <mat-icon
            matSuffix
            (click)="toggleNewPasswordConfirmVisibility()"
            style="cursor: pointer;"
            [attr.aria-label]="'Toggle password visibility'"
          >
            {{newPasswordConfirmVisible ? 'visibility_off' : 'visibility'}}
          </mat-icon>
          <mat-error *ngIf="changePasswordForm.controls['confirmPassword'].hasError('required')">{{'Confirm Password field is required'| translate}}</mat-error>
          <mat-error *ngIf="changePasswordForm.controls['confirmPassword'].hasError('passwordsNotEqual')">{{'Passwords not equal in New Password and Confirm Password fields'| translate}}</mat-error>

        </mat-form-field>
      </div>
      <div>
        <button
          class="btn-primary btn-primary--icon-left"
          id="changePasswordSaveBtn"
          [disabled]="!valid"
          (click)="updateUserPassword()"
        >
          {{ 'Save' | translate }}
        </button>
      </div>
    </div>
  </mat-card>
</form>
